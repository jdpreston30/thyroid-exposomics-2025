#* 9: Validation Plots Adjustment and Manual Review
if (config$analysis$run_validation_step) {
#+ 9.0: Notes
# The workflow was first to create the combined PDFs from 08. These were inspected visually and any obvious failures were assigned state = "failed" in the validation.xlsx file. Alternatively, any that clearly passed on first inspection were assigned "final".
# A quality score was given on the validation sheet- either F for fail, 1 for level 1, 2 for level 2. An asterisk on those indicates that there was an alternative ID for the same chemical which looked better (or state = "alternative").
# Level 1 quality was considered co-elution of 2 or more fragments of standard or sample within a reasonable time of each other. Far far spread in time was not considered a pass but close co-elution that could be reasonably explained by matrix effects was. Note that there were select cases where the quantiative fragment (asterisk, see below) could not be seen in the standard but could be seen in the sample, and the standard and sample had other co-eluting fragments. These were still considered level 1.
# Single fragments, even if co-eluting in standard and sample, were considered fails.
# Level 2 quality was when you could detect co-elution of 2 or more fragments in the sample but not the standard, or the standard co-eluting fragments were shifted extremely far away.
# The peak (asterisk) used for statistics/quant was considered closely in this process, such that if you zoomed in, even if it was a smaller peak in all of the co-eluting fragments, it still had to follow the same general trajectory as its other fragments. If it could really only be considered noise, then it was considered a fail.
#+ 9.1: Blank plot for a placeholder
blank_plot <- ggplot() + theme_void()
blank_grob <- ggplotGrob(blank_plot)
saveRDS(blank_grob, here::here("Outputs", "Validation", "revised", "grobs", "blank.rds"))
#+ 9.2: Plots that failed after review
#- 9.2.1: Methylparaben (CP2252)
F1_S1_CP2252_R <- vp(F1_S2_CP2252, xl = 4.3, xu = 4.50, subfolder = "failed")
F2_S1_CP2252_R <- vp(F2_S1_CP2252, xl = 4.3, xu = 4.50, subfolder = "failed")
F3_S1_CP2252_R <- vp(F3_S1_CP2252, xl = 4.3, xu = 4.50, subfolder = "failed")
F4_S1_CP2252_R <- vp(F4_S1_CP2252, xl = 4.3, xu = 4.50, subfolder = "failed")
F5_S1_CP2252_R <- vp(F5_S1_CP2252, xl = 4.3, xu = 4.50, subfolder = "failed")
F6_S1_CP2252_R <- vp(F6_S1_CP2252, xl = 4.3, xu = 4.50, subfolder = "failed")
#- 9.2.2: Cyfluthrin (CP3153)
F1_S2_CP3153_R <- vp(F1_S2_CP3153, subfolder = "failed")
F2_S2_CP3153_R <- vp(F2_S2_CP3153, subfolder = "failed")
F3_S2_CP3153_R <- vp(F3_S2_CP3153, subfolder = "failed")
F4_S1_CP3153_R <- vp(F4_S1_CP3153, xl = 8.2, xu = 8.5, subfolder = "failed")
F5_S1_CP3153_R <- vp(F5_S1_CP3153, subfolder = "failed")
F6_S1_CP3153_R <- vp(F6_S1_CP3153, subfolder = "failed")
#- 9.2.3: Napropamide (CP3135)
F1_S1_CP3135_R <- vp(F1_S1_CP3135, xl = NULL, xu = NULL, subfolder = "failed")
F2_S1_CP3135_R <- vp(F2_S1_CP3135, xl = 3.75, xu = 3.95, subfolder = "failed")
F3_S1_CP3135_R <- vp(F3_S1_CP3135, xl = 3.75, xu = 3.95, subfolder = "failed")
F4_S1_CP3135_R <- vp(F4_S1_CP3135, xl = NULL, xu = NULL, subfolder = "failed")
F5_S1_CP3135_R <- vp(F5_S1_CP3135, xl = NULL, xu = NULL, subfolder = "failed")
F6_S1_CP3135_R <- vp(F6_S1_CP3135, xl = 3.75, xu = NULL, subfolder = "failed")
#- 9.2.4: THPI (CP2075)
F6_S2_CP2075_R <- vp(F6_S2_CP2075, xl = 4.85, xu = 5.05, mz_fragment = -c(1,3,6), subfolder = "failed")
F1_S1_CP2075_R <- vp(F1_S1_CP2075, xl = 4.4, xu = 4.6, subfolder = "failed")
F2_S1_CP2075_R <- vp(F2_S1_CP2075, xl = 4.65, xu = 4.85, subfolder = "failed")
F3_S1_CP2075_R <- vp(F3_S1_CP2075, xl = 4.65, xu = 4.85, subfolder = "failed")
F5_S1_CP2075_R <- vp(F5_S1_CP2075, xl = 4.85, xu = 5.05, subfolder = "failed")
F4_S1_CP2075_R <- vp(F4_S1_CP2075, xl = 4.4, xu = 4.6, subfolder = "failed")
  #- 9.2.5: Molinate (CP2486)
vp(F1_S1_CP2486, remove_std = TRUE, xl = 5.1, xu = 5.175, subfolder = "failed")
  #- 9.2.6: Atrazine (CP3113)
vp(F6_S1_CP3113, subfolder = "failed")
#- 9.2.7: Bupirimate (CP2107)
vp(F1_S1_CP2107, subfolder = "failed")
#- 9.2.8: Resmethrin (CP3174)
vp(F2_S1_CP3174, subfolder = "failed")
#- 9.2.9: Vernolate (CP2487)
F1_S1_CP2487_R <- vp(F1_S1_CP2487, remove_std = TRUE, xl = 4.35, xu = 4.55, mz_fragment = NULL, subfolder = "failed")
#- 9.2.10: o-Anisidine (CP3021)
F1_S1_CP3021_R <- vp(F1_S1_CP3021, xl = 6.3, xu = 6.6, subfolder = "failed", remove_std = TRUE)
F1_S1_CP3021_RF <- vp(F1_S1_CP3021_R, mz_fragment = 2, subfolder = "failed", yu = 600000)
#- 9.2.11: 2-Nitroanilline (CP2212)
F6_S1_CP2212_R <- vp(F6_S1_CP2212, remove_std = TRUE, xl = 11.95, xu = 12.075, subfolder = "failed")
F6_S1_CP2212_RF <- vp(F6_S1_CP2212_R, xl = 11.95, xu = 12.075, mz_fragment = -c(1,2,3,5), subfolder = "failed")
#- 9.2.12: Chrysene (CP2225)
F1_S1_CP2225_R <- vp(F1_S1_CP2225, yl = -2e5, yu = 2e5, xl = 13.45, xu = 13.55, subfolder = "failed")
F1_S1_CP2225_RF <- vp(F1_S1_CP2225_R, yl = -2e5, yu = 2e5, xl = 13.475, xu = 13.51, mz_fragment = -c(0, 4), subfolder = "failed")
#- 9.2.13: Naphthalene (CP3068)
F1_S1_CP3068_R <- vp(F1_S1_CP3068, yl = -2.5e6, yu = 2.5e6, subfolder = "failed")
F1_S1_CP3068_RF <- vp(F1_S1_CP3068_R, yl = -2.5e5, yu = 2.5e5, mz_fragment = -0, xl = 3.15, xu = 3.35, subfolder = "failed")
#- 9.2.14: Benzo[a]pyrene (CP3028)
F2_S1_CP3028_R <- vp(F2_S1_CP3028, xl = NULL, xu = NULL, subfolder = "failed")
#- 9.2.15: o-Tolidine (CP2475)
F1_S1_CP2475_R <- vp(F1_S1_CP2475, xl = 7.65, xu = 8.2, yl = -1.3e6, yu = 2e6, subfolder = "failed")
F2_S1_CP2475_R <- vp(F2_S1_CP2475, xl = 7.85, xu =  7.98, yl = -1.3e6, yu = 4e6, subfolder = "failed")
F3_S1_CP2475_R <- vp(F3_S1_CP2475, xl = 7.85, xu =  7.98, yl = -1.3e6, yu = 4e6, subfolder = "failed")
F4_S1_CP2475_R <- vp(F4_S1_CP2475, xl = 7.85, xu =  7.98, yl = -1.3e6, yu = 4e6, subfolder = "failed")
F5_S1_CP2475_R <- vp(F5_S1_CP2475, xl = 7.85, xu = 8.1, yl = -1.3e6, yu = 4e6, subfolder = "failed")
F6_S1_CP2475_R <- vp(F6_S1_CP2475, xl = 7.85, xu = 8.1, yl = -1.3e6, yu = 2e6, subfolder = "failed")
#+ 9.3: SF 2.1 (Variant Differences, Level 1)
#- 9.3.1: o-Toluidine (CP3017)
F3_S2_CP3017_R <- vp(F3_S2_CP3017, xl = 8.0, xu = 8.15)
F3_S2_CP3017_RF <- vp(F3_S2_CP3017_R, mz_fragment = 2, save_grob = TRUE, title_add = "Fragment 2 Isolated")
#- 9.3.2: Benz(a)anthracene (CP2220)
F5_S1_CP2220_R <- vp(F5_S1_CP2220, yl = -3e5, yu = 3e5, xl = 13.25, xu = 13.375)
#- 9.3.3: Methoxychlor (CP1090)
F1_S1_CP1090_R <- vp(F1_S1_CP1090, yl = -2e5, yu = 4e5, xl = 13.71, xu = 13.85, mz_fragment = -3)
#- 9.3.4: N-MeFOSAA (CP3193)
F3_S1_CP3193_R <- vp(F3_S1_CP3193, xl = 19.36, xu = 19.65)
F3_S1_CP3193_F <- vp(F3_S1_CP3193_R, mz_fragment = -3, save_grob = TRUE, title_add = "Fragments 1, 2, and 4 Isolated")
#- 9.3.5: 5-NOT (CP3003)
F2_S1_CP3003_R <- vp(F2_S1_CP3003, yl = -3e6, yu = 3e6, xl = 6.4, xu = 6.475)
#- 9.3.6: Anthracene (CP3025)
F1_S1_CP3025_R <- vp(F1_S1_CP3025, yl = -2e7, yu = 2e7, xl = 6.4, xu = 6.475)
#- 9.3.7: Fluoranthene (CP2227)
F1_S1_CP2227_R <- vp(F1_S1_CP2227, yl = -2.6e6, yu = 1e6, xl = 9.06, xu = 9.2)
F1_S1_CP2227_RF <- vp(F1_S1_CP2227_R, yl = -6.5e5, yu = 2e5, mz_fragment = -0, save_grob = TRUE, title_add = "Fragments 1, 2, 3, and 4 Isolated")
#- 9.3.8: Pyrene (CP3078)
F1_S1_CP3078_R <- vp(F1_S1_CP3078, yl = -3.3e6, yu = 1.1e6, xl = 9.6, xu = 9.75)
#- 9.3.9: 2,4'-Methoxychlor (CP2049)
F3_S2_CP2049_R <- vp(F3_S2_CP2049, yl = -2e7, yu = 1.2e8, xl = 3.84, xu = 3.96)
#- 9.3.10: 3-Hydroxycarbofuran (CP2506)
F5_S1_CP2506_R <- vp(F5_S1_CP2506, xl = 9.35, xu = 9.7)
#- 9.3.11: Acetophenone (CP2516)
F6_S1_CP2516_R <- vp(F6_S1_CP2516, xl = 11.22, xu = 11.35)
F6_S1_CP2516_RF <- vp(F6_S1_CP2516_R, yl = -1e5, yu = 4e5, mz_fragment = -c(0,3, 4), save_grob = TRUE, title_add = "Fragments 1, 2, and 6 Isolated")
#- 9.3.12: Ethylan (CP2043)
F1_S2_CP2043_R <- vp(F1_S2_CP2043, xl = 22.2, xu = 22.6, yl = -6.6e6, yu = 1.5e6)
#- 9.3.13: Hexanoic acid (CP3180)
F6_S1_CP3180_R <- vp(F6_S1_CP3180, xl = 9.4, xu = 9.65, yl = -3e6, yu = 2.3e7)
F6_S1_CP3180_RF <- vp(F6_S1_CP3180_R, mz_fragment = -c(1,2,3,5,6), yl = -3e5, yu = 1e6, save_grob = TRUE, title_add = "Fragment 0 Isolated")
#- 9.3.14: Metalaxyl (CP2145)
F3_S2_CP2145_R <- vp(l(F3_S2_CP2145), xl = 9.41, xu = 9.52, yl = -5e6, yu = 1.1e7)
#- 9.4.16: OD-PABA (CP2331)
F4_S2_CP2331_R <- vp(F4_S2_CP2331, xl = 11, xu = 11.5)
#- 9.3.16: o-Cresol (CP3066)
F2_S2_CP3066_R <- vp(F2_S2_CP3066, xl = 7.3, xu = 7.475, yl = 1.5e7, yu = -1.5e7)
F2_S2_CP3066_RF <- vp(F2_S2_CP3066_R, mz_fragment = -4, save_grob = TRUE, title_add = "Fragments 0, 1, 2, and 3 Isolated")
#- 9.3.17: TTBNP (CP2302)
F1_S2_CP2302_R <- vp(F1_S2_CP2302, xl = 22.24, xu = 22.56)
#- 9.3.18: DNOP (CP2187)
F2_S2_CP2187_R <- vp(F2_S2_CP2187, xl = 17.95, xu = 18.2)
F2_S2_CP2187_RF <- vp(F2_S2_CP2187, xl = 17.95, xu = 18.2, mz_fragment = 1, save_grob = TRUE, title_add = "Fragment 1 Isolated")
#- 9.3.19: 2,4-Dimethylphenol (CP2237)
F6_S1_CP2237_R <- vp(F6_S1_CP2237, xl = 9.79, xu = 10.15)
#- 9.3.20: MEHP (CP2382)
F2_S1_CP2382_R <- vp(F2_S1_CP2382, xl = 9.75, xu = 10.2)
F2_S1_CP2382_F <- vp(F2_S1_CP2382_R, mz_fragment = 3, save_grob = TRUE, title_add = "Fragment 3 Isolated")
#- 9.3.21: Ethyl butyrate (CP2490)
F5_S1_CP2490_R <- vp(F5_S1_CP2490, xl = 7.63, xu = 7.94, yl = -2e7, yu = 9e7)
F5_S1_CP2490_RF <- vp(F5_S1_CP2490_R, mz_fragment = -c(2,3), yl = -1e6, yu = 6e6, save_grob = TRUE, title_add = "Fragments 0 and 1 Isolated")
#- 9.3.22: Terbuthylazine (CP2133)
F2_S1_CP2133_R <- vp(F2_S1_CP2133, xl = 6.5, xu = 6.9)
#- 9.3.23: TEEP (CP3182)
F6_S1_CP3182_R <- vp(F6_S1_CP3182, xl = 19.36, xu = 19.66)
F6_S1_CP3182_F <- vp(F6_S1_CP3182_R, mz_fragment = 3, save_grob = TRUE, title_add = "Fragment 3 Isolated")
#- 9.3.24: Prosulfuron (CP2365)
F6_S1_CP2365_R <- vp(F6_S1_CP2365, xl = 17.85, xu = 17.975)
F6_S1_CP2365_RF <- vp(F6_S1_CP2365_R, mz_fragment = 4, save_grob = TRUE, title_add = "Fragment 4 Isolated")
#- 9.3.25: DEET (CP2370)
F2_S1_CP2370_R <- vp(F2_S1_CP2370, xl = 4.9, xu = 5.13)
#- 9.3.26: Flucythrinate (CP3166)
F3_S1_CP3166_R <- vp(F3_S1_CP3166, xl = 17.1, xu = 17.5, yl = -1.3e5, yu = 2e5)
#+ 9.4: SF 2.2 (Variant Differences, Level 2)
#- 9.4.1: MDA (CP3007)
F3_S1_CP3007_R <- vp(F3_S1_CP3007, remove_std = TRUE, xl = 3.8, xu = 4)
#- 9.4.2: o-aminoazotoluene (CP3001)
F1_S1_CP3001_R <- vp(F1_S1_CP3001, xl = 7.4, xu = 7.55, remove_std = TRUE)
#- 9.4.3: Dibutyl phthalate (CP3047)
F1_S1_CP3047_R <- vp(F1_S1_CP3047, xl = 19.45, xu = 19.61, remove_std = TRUE, yl = 0, yu = 2.5e8)
#- 9.4.5: Menthone (CP3148)
F5_S1_CP3148_R <- vp(F5_S1_CP3148, remove_std = TRUE, xl = 8.05, xu = 8.3, yu = 2500000)
F5_S1_CP3148_RF <- vp(F5_S1_CP3148_R, mz_fragment = 3, yu = 25000, title_add = "Fragment 3 Isolated")
#+ 9.5: SF 3.1 (IARC, Level 1)
#- 9.5.1: o-Toluidine (CP3017)
# Already run above in 9.3.1
#- 9.5.2: Pentachlorophenol (CP1016)
F1_S1_CP1016_R <- vp(F1_S1_CP1016, yl = -1.5e6, yu = 1.6e6, xl =6.39, xu = 6.48)
#- 9.5.3: γ-BHC (CP1074)
F1_S1_CP1074_R <- vp(F1_S1_CP1074, yl = -1e5, yu = 4e5, xl = 6.35, xu = 6.45)
#- 9.5.4: Phenacetin (CP2545)
F6_S2_CP2545_R <- vp(F6_S2_CP2545, yl = -2e5, yu = 5e5, xl =6.075, xu = 6.2)
#+ 9.6: SF 3.2 (IARC, Level 2)
#- 9.6.1: 2-Naphthylamine (CP2535)
F5_S1_CP2535_R <- vp(F5_S1_CP2535, xl = 7.4, xu = 7.55, remove_std = TRUE, yl = 0, yu = 3.6e6)
#- 9.6.2: 4-ABP (CP3002)
F1_S1_CP3002_R <- vp(F1_S1_CP3002, xl = 5.15, xu = 5.27, remove_std = TRUE)
#- 9.6.3: MOCA (CP3013)
F3_S1_CP3013_R <- vp(F3_S1_CP3013, xl = 13.05, xu = 13.25, remove_std = TRUE)
#- 9.6.4: 2-ABP (CP3020)
F2_S1_CP3020_R <- vp(F2_S1_CP3020, xl = 7.2, xu = 7.36, remove_std = TRUE)
#+ 9.7: SF 3.1 (IARC, Level 1; Cadaver)
#- 9.7.1: o-Toluidine (CP3017)
C_F3_S2_CP3017_R <- vp(C_F1_S2_CP3017, xl = 7.9, xu = 8.06)
#- 9.7.2: Pentachlorophenol (CP1016)
C_F1_S1_CP1016_R <- vp(C_F1_S1_CP1016, xl = 6.31, xu = 6.45)
#- 9.7.3: γ-BHC (CP1074)
C_F1_S1_CP1074_R <- vp(C_F1_S1_CP1074, xl =6.3, xu = 6.44)
#- 9.7.4: Phenacetin (CP2545)
C_F1_S2_CP2545_R <- vp(C_F1_S2_CP2545, xl = 6.55, xu = 6.75, yl = -1e5, yu = 1.3e5)
#- 9.7.5: 2-Naphthylamine (CP2535)
C_F1_S1_CP2535_R <- vp(C_F1_S1_CP2535, xl = 7.45, xu = 7.57, yl = -2e6, yu = 1.5e6)
#- 9.8.6: 2-ABP (CP3020)
C_F4_S1_CP3020_R <- vp(C_F4_S1_CP3020, , xl = 7.38, xu = 7.46, yl = -3e4, yu = 8e4)
#+ 9.8: SF 3.2 (IARC, Level 2; Cadaver)
#- 9.8.1: 4-ABP (CP3002)
C_F1_S1_CP3002_R <- vp(C_F1_S1_CP3002, xl = 5.13, xu = 5.22, yl = 0, yu = 1e5,remove_std = TRUE)
#- 9.8.2: MOCA (CP3013)
C_F1_S1_CP3013_R <- vp(C_F1_S1_CP3013, xl = 12.63, xu = 12.76, remove_std = TRUE)
#+ 9.9: IARC 1 Top Fragments
#- 9.9.1: Bring in top fragments list
validation_check_files_subids <- validation_check_files |>
  filter(!is.na(top_frag)) |>
  select(id, top_frag)
#- 9.9.2: o-Toluidine (CP3017)
F3_S2_CP3017_top <- vp_top(F1_S1_CP3017, frag_lookup = validation_check_files_subids, subfolder = "top_fragments")


#- Gamma BHC
F3_S2_CP3017_top <- vp_top(F1_S1_CP1074, frag_lookup = validation_check_files_subids, subfolder = "top_fragments")
F3_S2_CP3017_R <- vp(F3_S2_CP3017, subfolder = "top_fragments", mz_fragment = 3)


#+ 9.9: Skip entire section if YAML specifies
} else {
  cat("⏭️  Skipping validation plots adjustment (config$analysis$run_validation_step = FALSE)\n")
}