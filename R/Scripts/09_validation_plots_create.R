#* 9: Validation Plots Adjustment and Manual Review
if (!isTRUE(config$skip_validation_plots)) {
#+ 9.1: Manual load and global modification (final plots)
#- 9.1.1: Load compiled validation plots
{
  l(F1_S1_CP2475)
  l(F1_S2_CP2302)
  l(F5_S2_CP3153)
  l(F2_S2_CP2187)
  l(F6_S1_CP2237)
  l(F5_S1_CP2490)
  l(F6_S2_CP2133)
  l(F6_S2_CP2075)
  l(F2_S1_CP2370)
  l(F5_S1_CP2535)
  l(F1_S1_CP3002)
  l(F6_S1_CP3013)
  l(F2_S1_CP3020)
  l(F2_S1_CP3028)
  l(F1_S1_CP3001)
  l(F1_S1_CP3047)
  l(F1_S1_CP2252)
  l(F1_S1_CP3135)
  l(F4_S2_CP2331)
  l(F3_S1_CP3166)
}
#- 9.1.3: Apply formatting and save grobs
{
  plot_names <- c("F1_S1_CP2475", "F1_S2_CP2302", "F5_S2_CP3153", "F2_S2_CP2187", "F6_S1_CP2237", "F5_S1_CP2490", "F6_S2_CP2133", "F6_S2_CP2075", "F2_S1_CP2370", "F5_S1_CP2535", "F1_S1_CP3002", "F6_S1_CP3013", "F2_S1_CP3020", "F2_S1_CP3028", "F1_S1_CP3001", "F1_S1_CP3047", "F1_S1_CP2252", "F1_S1_CP3135", "F4_S2_CP2331", "F3_S1_CP3166")
  purrr::walk(plot_names, ~vp(get(.x), subfolder = "final", save_grob = TRUE))
  cat(sprintf("✓ Applied formatting and saved %d grobs to Outputs/Validation/final/grobs/\n", length(plot_names)))
}
#+ 9.2: Plots that failed after review
#- 9.2.0: Import
{
  l(F1_S1_CP2486)
  l(F1_S1_CP2225)
  l(F6_S1_CP3113)
  l(F1_S1_CP2107)
  l(F1_S1_CP2227)
  l(F2_S1_CP3174)
  l(F1_S1_CP2487)
  l(F1_S1_CP3021)
  l(F6_S1_CP2212)
  l(F1_S1_CP3068)
}
#- 9.2.2: Adjust plots
{
#_ Molinate (CP2486)
vp(F1_S1_CP2486, remove_std = TRUE, xl = 5.1, xu = 5.175, subfolder = "failed", save_grob = TRUE)
#_ Atrazine (CP3113)
vp(F6_S1_CP3113, subfolder = "failed", save_grob = TRUE)
#_ Bupirimate (CP2107)
vp(F1_S1_CP2107, subfolder = "failed", save_grob = TRUE)
#_ Resmethrin (CP3174)
vp(F2_S1_CP3174, subfolder = "failed", save_grob = TRUE)
#_ Vernolate (CP2487)
F1_S1_CP2487_R <- vp(F1_S1_CP2487, remove_std = TRUE, xl = 4.35, xu = 4.55, mz_fragment = NULL, subfolder = "failed", save_grob = TRUE)
#_ o-Anisidine (CP3021)
F1_S1_CP3021_R <- vp(F1_S1_CP3021, xl = 6.3, xu = 6.6, subfolder = "failed", remove_std = TRUE, save_grob = TRUE)
F1_S1_CP3021_RF <- vp(F1_S1_CP3021_R, mz_fragment = 2, subfolder = "failed", yu = 600000, save_grob = TRUE)
#_ 2-Nitroanilline (CP2212)
F6_S1_CP2212_R <- vp(F6_S1_CP2212, remove_std = TRUE, xl = 11.95, xu = 12.075, subfolder = "failed", save_grob = TRUE)
F6_S1_CP2212_RF <- vp(F6_S1_CP2212_R, xl = 11.95, xu = 12.075, mz_fragment = -c(1,2,3,5), subfolder = "failed", save_grob = TRUE)
#_ Chrysene (CP2225)
F1_S1_CP2225_R <- vp(F1_S1_CP2225, yl = -2e5, yu = 2e5, xl = 13.45, xu = 13.55)
F1_S1_CP2225_RF <- vp(F1_S1_CP2225_R, yl = -2e5, yu = 2e5, xl = 13.475, xu = 13.51, mz_fragment = -c(0, 4))
#_ Naphthalene (CP3068)
F1_S1_CP3068_R <- vp(F1_S1_CP3068, yl = -2.5e6, yu = 2.5e6)
F1_S1_CP3068_RF <- vp(F1_S1_CP3068_R, yl = -2.5e5, yu = 2.5e5, mz_fragment = -0, xl = 3.15, xu = 3.35)
}
#+ 9.3: Revise Plots (X-axis adjust and/or fragment zoom)
#- 9.3.0: Import
{
  l(F2_S1_CP3003)
  l(F3_S2_CP2049)
  l(F1_S1_CP3025)
  l(F5_S1_CP2220)
  l(F1_S1_CP1074)
  l(F6_S2_CP2545)
  l(F1_S1_CP1016)
  l(F1_S1_CP1090)
  l(F2_S1_CP2382)
  l(F6_S1_CP3182)
  l(F1_S1_CP3078)
  l(F3_S1_CP3193)
  l(F6_S1_CP2365)
  l(F3_S2_CP3017)
  l(F2_S2_CP3066)
  l(F5_S1_CP2506)
  l(F1_S2_CP2043)
  l(F6_S1_CP2516)
  l(F6_S1_CP3180)
  l(F3_S2_CP2145)
}
#- 9.3.2: Adjust plots
{
#_ Metalaxyl (CP2145)
F3_S2_CP2145_R <- vp(F3_S2_CP2145, xl = 9.41, xu = 9.52, yl = -5e6, yu = 1.1e7)
#_ Hexanoic acid (CP3180)
F6_S1_CP3180_R <- vp(F6_S1_CP3180, xl = 9.4, xu = 9.65, yl = -3e6, yu = 2.3e7)
F6_S1_CP3180_RF <- vp(F6_S1_CP3180_R, mz_fragment = -c(1,2,3,5,6), yl = -3e5, yu = 1e6)
#_ Ethylan (CP2043)
F1_S2_CP2043_R <- vp(F1_S2_CP2043, xl = 22.2, xu = 22.6, yl = -6.6e6, yu = 1.5e6)
#_ 3-Hydroxycarbofuran (CP2506)
F5_S1_CP2506_R <- vp(F5_S1_CP2506, xl = 9.35, xu = 9.7)
#_ 2,4'-Methoxychlor (CP2049)
F3_S2_CP2049_R <- vp(F3_S2_CP2049, yl = -2e7, yu = 1.2e8, xl = 3.84, xu = 3.96)
#_ Acetophenone (CP2516)
F6_S1_CP2516_R <- vp(F6_S1_CP2516, xl = 11.22, xu = 11.35)
F6_S1_CP2516_RF <- vp(F6_S1_CP2516_R, yl = -1e5, yu = 4e5, mz_fragment = -c(0,4))
#_ MEHP (CP2382)
F2_S1_CP2382_R <- vp(F2_S1_CP2382, xl = 9.75, xu = 10.2, save_grob = TRUE)
F2_S1_CP2382_F <- vp(F2_S1_CP2382_R, mz_fragment = 3, save_grob = TRUE, title_add = "Fragment 3 Isolated")
#_ TEEP (CP3182)
F6_S1_CP3182_R <- vp(F6_S1_CP3182, xl = 19.36, xu = 19.66, save_grob = TRUE)
F6_S1_CP3182_F <- vp(F6_S1_CP3182_R, mz_fragment = 3, save_grob = TRUE, title_add = "Fragment 3 Isolated")
#_ N-MeFOSAA (CP3193)
F3_S1_CP3193_R <- vp(F3_S1_CP3193, xl = 19.36, xu = 19.65, save_grob = TRUE)
F3_S1_CP3193_F <- vp(F3_S1_CP3193_R, mz_fragment = -3, save_grob = TRUE, title_add = "Fragments 1, 2, and 4 Isolated")
#_ Prosulfuron (CP2365)
F6_S1_CP2365_R <- vp(F6_S1_CP2365, xl = 17.85, xu = 17.975, save_grob = TRUE)
F6_S1_CP2365_RF <- vp(F6_S1_CP2365_R, mz_fragment = 4, save_grob = TRUE, title_add = "Fragment 4 Isolated")
#_ o-Toluidine (CP3017)
F3_S2_CP3017_R <- vp(F3_S2_CP3017, xl = 8.0, xu = 8.15, save_grob = TRUE)
F3_S2_CP3017_RF <- vp(F3_S2_CP3017_R, mz_fragment = 2, save_grob = TRUE)
#_ o-Cresol (CP3066)
F2_S2_CP3066_R <- vp(F2_S2_CP3066, xl = 7.3, xu = 7.475, yl = 1.5e7, yu = -1.5e7, save_grob = TRUE)
F2_S2_CP3066_RF <- vp(F2_S2_CP3066_R, mz_fragment = -4, save_grob = TRUE)
#_ Fluoranthene (CP2227)
F1_S1_CP2227_R <- vp(F1_S1_CP2227, yl = -2.6e6, yu = 1e6, xl = 9.06, xu = 9.2)
F1_S1_CP2227_RF <- vp(F1_S1_CP2227_R, yl = -6.5e5, yu = 2e5, mz_fragment = -0)
#_ 5-NOT (CP3003)
F2_S1_CP3003_R <- vp(F2_S1_CP3003, yl = -3e6, yu = 3e6, xl = 6.4, xu = 6.475)
#_ Anthracene (CP3025)
F1_S1_CP3025_R <- vp(F1_S1_CP3025, yl = -2e7, yu = 2e7, xl = 6.4, xu = 6.475)
#_ Benz(a)anthracene (CP2220)
F5_S1_CP2220_R <- vp(F5_S1_CP2220, yl = -3e5, yu = 3e5, xl = 13.25, xu = 13.375)
#_ γ-BHC (CP1074)
F1_S1_CP1074_R <- vp(F1_S1_CP1074, yl = -1e5, yu = 4e5, xl = 6.35, xu = 6.45)
#_ Phenacetin (CP2545)
F6_S2_CP2545_R <- vp(F6_S2_CP2545, yl = -2e5, yu = 5e5, xl =6.075, xu = 6.2)
#_ Pentachlorophenol (CP1016)
F1_S1_CP1016_R <- vp(F1_S1_CP1016, yl = -1.5e6, yu = 1.6e6, xl =6.39, xu = 6.48)
#_ Methoxychlor (CP1090)
F1_S1_CP1090_R <- vp(F1_S1_CP1090, yl = -2e5, yu = 4e5, xl = 13.71, xu = 13.85, mz_fragment = -3)
#_ Pyrene (CP3078)
F1_S1_CP3078_R <- vp(F1_S1_CP3078, yl = -3.3e6, yu = 1.1e6, xl = 9.6, xu = 9.75)
}
#+ 9.4: Revise Plots (Remove standard peak -> level 2)
#- 9.4.0: Import
{
  l(F3_S1_CP3007)
  l(F5_S1_CP3148)
}
#- 9.4.2: Adjust plots
{
#_ MDA (CP3007)
F3_S1_CP3007_R <- vp(F3_S1_CP3007, remove_std = TRUE, xl = 3.8, xu = 4, save_grob = TRUE)
#_ Menthone (CP3148)
F5_S1_CP3148_R <- vp(F5_S1_CP3148, remove_std = TRUE, xl = 8.05, xu = 8.3, yu = 2500000, save_grob = TRUE)
F5_S1_CP3148_RF <- vp(F5_S1_CP3148_R, mz_fragment = 3, yu = 25000, save_grob = TRUE)
}
#- 9.4.3: Skip entire section if YAML specifies
} else {
  cat("⊘ Skipping validation plots adjustment (config$skip_validation_plots = TRUE)\n")
}